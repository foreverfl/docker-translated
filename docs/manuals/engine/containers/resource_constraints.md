---
title: 리소스 제약
weight: 30
description: 컨테이너의 런타임 옵션 지정
keywords:
  - 도커
  - 데몬
  - 구성
  - 런타임
aliases:
  - /engine/admin/resource_constraints/
  - /config/containers/resource_constraints/
---

기본적으로 컨테이너에는 리소스 제약이 없으며 호스트의 커널 스케줄러가 허용하는 만큼의 리소스를 사용할 수 있습니다. Docker는 `docker run` 명령의 런타임 구성 플래그를 설정하여 컨테이너가 사용할 수 있는 메모리 또는 CPU의 양을 제어하는 방법을 제공합니다. 이 섹션에서는 이러한 제한을 설정해야 하는 경우와 설정 시의 가능한 영향을 설명합니다.

이러한 기능 중 많은 부분은 Linux 기능을 지원하는 커널이 필요합니다. 지원 여부를 확인하려면 [`docker info`](/reference/cli/docker/system/info.md) 명령을 사용할 수 있습니다. 커널에서 기능이 비활성화된 경우 다음과 같은 경고가 출력될 수 있습니다:

```console
WARNING: No swap limit support
```

기능을 활성화하는 방법은 운영 체제의 문서를 참조하십시오. 자세한 내용은 [Docker Engine 문제 해결 가이드](../daemon/troubleshoot.md#kernel-cgroup-swap-limit-capabilities)를 참조하십시오.

## 메모리 {#memory}

## 메모리 부족의 위험 이해 {#understand-the-risks-of-running-out-of-memory}

실행 중인 컨테이너가 호스트 머신의 메모리를 너무 많이 소비하지 않도록 하는 것이 중요합니다. Linux 호스트에서 커널이 중요한 시스템 기능을 수행할 메모리가 부족하다고 감지하면 `OOME` 또는 `Out Of Memory Exception`을 발생시키고 프로세스를 종료하여 메모리를 확보합니다. Docker 및 기타 중요한 애플리케이션을 포함한 모든 프로세스가 종료될 수 있습니다. 잘못된 프로세스가 종료되면 시스템 전체가 다운될 수 있습니다.

Docker는 Docker 데몬의 OOM 우선 순위를 조정하여 다른 시스템 프로세스보다 종료될 가능성을 줄여 이러한 위험을 완화하려고 합니다. 컨테이너의 OOM 우선 순위는 조정되지 않습니다. 이는 Docker 데몬이나 다른 시스템 프로세스보다 개별 컨테이너가 종료될 가능성을 높입니다. 데몬이나 컨테이너에서 `--oom-score-adj`를 극단적으로 낮은 값으로 설정하거나 컨테이너에서 `--oom-kill-disable`을 설정하여 이러한 보호 장치를 우회하려고 하지 마십시오.

Linux 커널의 OOM 관리에 대한 자세한 내용은 [Out of Memory Management](https://www.kernel.org/doc/gorman/html/understand/understand016.html)를 참조하십시오.

다음 방법으로 OOME로 인한 시스템 불안정을 완화할 수 있습니다:

- 애플리케이션을 프로덕션에 배포하기 전에 메모리 요구 사항을 이해하기 위해 테스트를 수행하십시오.
- 애플리케이션이 충분한 리소스를 가진 호스트에서만 실행되도록 하십시오.
- 아래 설명된 대로 컨테이너가 사용할 수 있는 메모리 양을 제한하십시오.
- Docker 호스트에서 스왑을 구성할 때 주의하십시오. 스왑은 메모리보다 느리지만 시스템 메모리 부족에 대한 버퍼를 제공할 수 있습니다.
- 컨테이너를 [서비스](/manuals/engine/swarm/services.md)로 변환하고 서비스 수준 제약 및 노드 레이블을 사용하여 애플리케이션이 충분한 메모리를 가진 호스트에서만 실행되도록 고려하십시오.

### 컨테이너의 메모리 접근 제한 {#limit-a-containers-access-to-memory}

Docker는 하드 또는 소프트 메모리 제한을 적용할 수 있습니다.

- 하드 제한은 컨테이너가 고정된 양의 메모리만 사용할 수 있도록 합니다.
- 소프트 제한은 호스트 머신에서 커널이 메모리 부족 또는 경쟁을 감지하는 경우와 같은 특정 조건이 충족되지 않는 한 컨테이너가 필요한 만큼의 메모리를 사용할 수 있도록 합니다.

이 옵션 중 일부는 단독으로 사용하거나 여러 옵션을 설정할 때 다른 효과를 가질 수 있습니다.

대부분의 옵션은 양의 정수 뒤에 `b`, `k`, `m`, `g` 접미사를 붙여 바이트, 킬로바이트, 메가바이트 또는 기가바이트를 나타냅니다.

| 옵션                    | 설명                                                                                                                                                                                                                                                                                                                                                                                     |
| :--------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `-m` 또는 `--memory=`  | 컨테이너가 사용할 수 있는 최대 메모리 양입니다. 이 옵션을 설정하면 최소 허용 값은 `6m`(6 메가바이트)입니다. 즉, 최소 6 메가바이트로 값을 설정해야 합니다.                                                                                                                                                                                                           |
| `--memory-swap`\*      | 이 컨테이너가 디스크로 스왑할 수 있는 메모리 양입니다. [`--memory-swap` 세부 정보](#--memory-swap-details)를 참조하십시오.                                                                                                                                                                                                                                                                          |
| `--memory-swappiness`  | 기본적으로 호스트 커널은 컨테이너가 사용하는 익명 페이지의 일부를 스왑할 수 있습니다. 이 비율을 조정하려면 `--memory-swappiness`를 0에서 100 사이의 값으로 설정할 수 있습니다. [`--memory-swappiness` 세부 정보](#--memory-swappiness-details)를 참조하십시오.                                                                                                                                       |
| `--memory-reservation` | Docker가 호스트 머신에서 경쟁 또는 메모리 부족을 감지할 때 활성화되는 `--memory`보다 작은 소프트 제한을 지정할 수 있습니다. `--memory-reservation`을 사용하는 경우 우선 순위를 가지려면 `--memory`보다 낮게 설정해야 합니다. 소프트 제한이기 때문에 컨테이너가 제한을 초과하지 않는다는 보장은 없습니다.                                                |
| `--kernel-memory`      | 컨테이너가 사용할 수 있는 최대 커널 메모리 양입니다. 최소 허용 값은 `6m`입니다. 커널 메모리는 스왑할 수 없기 때문에 커널 메모리가 부족한 컨테이너는 호스트 머신 리소스를 차단할 수 있으며, 이는 호스트 머신 및 다른 컨테이너에 부작용을 일으킬 수 있습니다. [`--kernel-memory` 세부 정보](#--kernel-memory-details)를 참조하십시오.                                   |
| `--oom-kill-disable`   | 기본적으로 메모리 부족(OOM) 오류가 발생하면 커널이 컨테이너의 프로세스를 종료합니다. 이 동작을 변경하려면 `--oom-kill-disable` 옵션을 사용하십시오. OOM 킬러를 비활성화하려면 `-m/--memory` 옵션도 설정해야 합니다. `-m` 플래그가 설정되지 않은 경우 호스트가 메모리를 다 써버릴 수 있으며 커널이 호스트 시스템의 프로세스를 종료해야 할 수 있습니다. |

cgroups 및 메모리에 대한 자세한 내용은 [Memory Resource Controller](https://www.kernel.org/doc/Documentation/cgroup-v1/memory.txt) 문서를 참조하십시오.

### `--memory-swap` 세부 정보 {#--memory-swap-details}

`--memory-swap`은 `--memory`가 설정된 경우에만 의미가 있는 수정자 플래그입니다. 스왑을 사용하면 컨테이너가 사용할 수 있는 모든 RAM을 소진했을 때 초과 메모리 요구 사항을 디스크에 기록할 수 있습니다. 메모리를 디스크로 자주 스왑하는 애플리케이션에는 성능 페널티가 있습니다.

설정은 복잡한 영향을 미칠 수 있습니다:

- `--memory-swap`이 양의 정수로 설정된 경우 `--memory`와 `--memory-swap` 모두 설정해야 합니다. `--memory-swap`은 사용할 수 있는 총 메모리와 스왑을 나타내며, `--memory`는 스왑되지 않은 메모리의 양을 제어합니다. 따라서 `--memory="300m"` 및 `--memory-swap="1g"`로 설정하면 컨테이너는 300m의 메모리와 700m(`1g - 300m`)의 스왑을 사용할 수 있습니다.

- `--memory-swap`이 `0`으로 설정된 경우 설정이 무시되고 값이 설정되지 않은 것으로 간주됩니다.

- `--memory-swap`이 `--memory`와 동일한 값으로 설정되고 `--memory`가 양의 정수로 설정된 경우 **컨테이너는 스왑에 접근할 수 없습니다**. [컨테이너가 스왑을 사용하지 못하게 하기](#prevent-a-container-from-using-swap)를 참조하십시오.

- `--memory-swap`이 설정되지 않고 `--memory`가 설정된 경우 호스트 컨테이너에 스왑 메모리가 구성된 경우 컨테이너는 `--memory` 설정만큼의 스왑을 사용할 수 있습니다. 예를 들어 `--memory="300m"` 및 `--memory-swap`이 설정되지 않은 경우 컨테이너는 총 600m의 메모리와 스왑을 사용할 수 있습니다.

- `--memory-swap`이 명시적으로 `-1`로 설정된 경우 컨테이너는 호스트 시스템에서 사용할 수 있는 만큼의 무제한 스왑을 사용할 수 있습니다.

- 컨테이너 내부에서 `free`와 같은 도구는 컨테이너 내부에서 사용할 수 있는 스왑이 아닌 호스트의 사용 가능한 스왑을 보고합니다. `free` 또는 유사한 도구의 출력을 신뢰하여 스왑이 있는지 여부를 결정하지 마십시오.

#### 컨테이너가 스왑을 사용하지 못하게 하기 {#prevent-a-container-from-using-swap}

`--memory`와 `--memory-swap`이 동일한 값으로 설정된 경우 이는 컨테이너가 스왑을 사용하지 못하게 합니다. 이는 `--memory-swap`이 사용할 수 있는 총 메모리와 스왑의 양을 나타내고 `--memory`는 사용할 수 있는 물리적 메모리의 양을 나타내기 때문입니다.

### `--memory-swappiness` 세부 정보 {#--memory-swappiness-details}

- 0의 값은 익명 페이지 스왑을 끕니다.
- 100의 값은 모든 익명 페이지를 스왑 가능하게 설정합니다.
- 기본적으로 `--memory-swappiness`를 설정하지 않으면 값은 호스트 머신에서 상속됩니다.

### `--kernel-memory` 세부 정보 {#--kernel-memory-details}

커널 메모리 제한은 컨테이너에 할당된 전체 메모리 측면에서 표현됩니다. 다음 시나리오를 고려하십시오:

- **무제한 메모리, 무제한 커널 메모리**: 이것이 기본 동작입니다.
- **무제한 메모리, 제한된 커널 메모리**: 모든 cgroup이 필요로 하는 메모리 양이 호스트 머신에 실제로 존재하는 메모리 양보다 클 때 적합합니다. 호스트 머신에서 사용할 수 있는 메모리를 초과하지 않도록 커널 메모리를 구성할 수 있으며, 더 많은 메모리가 필요한 컨테이너는 기다려야 합니다.
- **제한된 메모리, 무제한 커널 메모리**: 전체 메모리는 제한되지만 커널 메모리는 제한되지 않습니다.
- **제한된 메모리, 제한된 커널 메모리**: 사용자 및 커널 메모리를 모두 제한하는 것은 메모리 관련 문제를 디버깅하는 데 유용할 수 있습니다. 컨테이너가 예상치 못한 양의 메모리 중 하나를 사용하면 다른 컨테이너나 호스트 머신에 영향을 주지 않고 메모리가 부족해집니다. 이 설정 내에서 커널 메모리 제한이 사용자 메모리 제한보다 낮으면 커널 메모리가 부족하여 컨테이너가 OOM 오류를 경험합니다. 커널 메모리 제한이 사용자 메모리 제한보다 높으면 커널 제한이 컨테이너가 OOM을 경험하게 하지 않습니다.

커널 메모리 제한을 활성화하면 호스트 머신은 프로세스별로 "최대 사용량" 통계를 추적하여 어떤 프로세스(이 경우 컨테이너)가 과도한 메모리를 사용하고 있는지 추적할 수 있습니다. 이는 호스트 머신에서 `/proc/<PID>/status`를 확인하여 프로세스별로 볼 수 있습니다.

## CPU {#cpu}

기본적으로 각 컨테이너의 호스트 머신의 CPU 사이클 접근은 무제한입니다. 주어진 컨테이너의 호스트 머신의 CPU 사이클 접근을 제한하기 위해 다양한 제약을 설정할 수 있습니다. 대부분의 사용자는 [기본 CFS 스케줄러 구성](#configure-the-default-cfs-scheduler)을 사용하고 구성합니다. 또한 [실시간 스케줄러 구성](#configure-the-real-time-scheduler)을 구성할 수 있습니다.

### 기본 CFS 스케줄러 구성 {#configure-the-default-cfs-scheduler}

CFS는 일반 Linux 프로세스를 위한 Linux 커널 CPU 스케줄러입니다. 여러 런타임 플래그를 사용하여 컨테이너가 CPU 리소스에 접근할 수 있는 양을 구성할 수 있습니다. 이러한 설정을 사용할 때 Docker는 호스트 머신의 컨테이너 cgroup 설정을 수정합니다.

| 옵션                    | 설명                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| :--------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `--cpus=<value>`       | 컨테이너가 사용할 수 있는 가용 CPU 리소스의 양을 지정합니다. 예를 들어 호스트 머신에 두 개의 CPU가 있고 `--cpus="1.5"`를 설정하면 컨테이너는 최대 1.5개의 CPU를 사용할 수 있습니다. 이는 `--cpu-period="100000"` 및 `--cpu-quota="150000"`을 설정하는 것과 동일합니다.                                                                                                                                                                                                                                                                                              |
| `--cpu-period=<value>` | `--cpu-quota`와 함께 사용되는 CPU CFS 스케줄러 기간을 지정합니다. 기본값은 100000 마이크로초(100 밀리초)입니다. 대부분의 사용자는 기본값에서 변경하지 않습니다. 대부분의 사용 사례에서는 `--cpus`가 더 편리한 대안입니다.                                                                                                                                                                                                                                                                                                                                                     |
| `--cpu-quota=<value>`  | 컨테이너에 CPU CFS 할당량을 부과합니다. 컨테이너가 제한되기 전에 `--cpu-period`당 마이크로초 수입니다. 따라서 효과적인 상한선으로 작용합니다. 대부분의 사용 사례에서는 `--cpus`가 더 편리한 대안입니다.                                                                                                                                                                                                                                                                                                                                                  |
| `--cpuset-cpus`        | 컨테이너가 사용할 수 있는 특정 CPU 또는 코어를 제한합니다. 여러 CPU가 있는 경우 컨테이너가 사용할 수 있는 CPU의 쉼표로 구분된 목록 또는 하이픈으로 구분된 범위입니다. 첫 번째 CPU는 0번으로 번호가 매겨집니다. 유효한 값은 `0-3`(첫 번째, 두 번째, 세 번째 및 네 번째 CPU 사용) 또는 `1,3`(두 번째 및 네 번째 CPU 사용)일 수 있습니다.                                                                                                                                                                                                                                                                        |
| `--cpu-shares`         | 이 플래그를 기본값인 1024보다 크거나 작은 값으로 설정하여 컨테이너의 가중치를 증가 또는 감소시키고 호스트 머신의 CPU 사이클에 대한 접근을 증가 또는 감소시킵니다. 이는 CPU 사이클이 제한될 때만 적용됩니다. 충분한 CPU 사이클이 있는 경우 모든 컨테이너는 필요한 만큼의 CPU를 사용합니다. 이러한 방식으로 이는 소프트 제한입니다. `--cpu-shares`는 Swarm 모드에서 컨테이너가 예약되는 것을 방지하지 않습니다. 이는 사용 가능한 CPU 사이클에 대한 컨테이너 CPU 리소스를 우선시합니다. 특정 CPU 접근을 보장하거나 예약하지 않습니다. |

CPU가 1개인 경우 다음 명령은 컨테이너에 매 초 최대 50%의 CPU를 보장합니다.

```console
$ docker run -it --cpus=".5" ubuntu /bin/bash
```

이는 `--cpu-period` 및 `--cpu-quota`를 수동으로 지정하는 것과 동일합니다:

```console
$ docker run -it --cpu-period=100000 --cpu-quota=50000 ubuntu /bin/bash
```

### 실시간 스케줄러 구성 {#configure-the-real-time-scheduler}

CFS 스케줄러를 사용할 수 없는 작업을 위해 컨테이너가 실시간 스케줄러를 사용하도록 구성할 수 있습니다. [호스트 머신의 커널이 올바르게 구성되었는지 확인](#configure-the-host-machines-kernel)한 후 [Docker 데몬 구성](#configure-the-docker-daemon) 또는 [개별 컨테이너 구성](#configure-individual-containers)을 수행할 수 있습니다.

:::warning
CPU 스케줄링 및 우선 순위 지정은 고급 커널 수준 기능입니다. 대부분의 사용자는 이러한 값을 기본값에서 변경할 필요가 없습니다. 이러한 값을 잘못 설정하면 호스트 시스템이 불안정하거나 사용 불가능해질 수 있습니다.
:::

#### 호스트 머신의 커널 구성 {#configure-the-host-machines-kernel}

Linux 커널에서 `CONFIG_RT_GROUP_SCHED`가 활성화되어 있는지 `zcat /proc/config.gz | grep CONFIG_RT_GROUP_SCHED`를 실행하거나 `/sys/fs/cgroup/cpu.rt_runtime_us` 파일의 존재 여부를 확인하여 확인하십시오. 커널 실시간 스케줄러 구성에 대한 지침은 운영 체제의 문서를 참조하십시오.

#### Docker 데몬 구성 {#configure-the-docker-daemon}

실시간 스케줄러를 사용하는 컨테이너를 실행하려면 Docker 데몬을 `--cpu-rt-runtime` 플래그를 설정하여 런타임 기간당 실시간 작업에 예약된 최대 마이크로초 수로 실행하십시오. 예를 들어 기본 기간인 1000000 마이크로초(1초)로 `--cpu-rt-runtime=950000`을 설정하면 실시간 스케줄러를 사용하는 컨테이너는 1000000 마이크로초 기간 동안 950000 마이크로초 동안 실행될 수 있으며, 최소 50000 마이크로초는 비실시간 작업에 사용할 수 있습니다. `systemd`를 사용하는 시스템에서 이 구성을 영구적으로 만들려면 `docker` 서비스에 대한 systemd 유닛 파일을 만드십시오. 예제는 [systemd 유닛 파일](../daemon/proxy.md#systemd-unit-file)을 사용하여 데몬을 프록시로 구성하는 방법에 대한 지침을 참조하십시오.

#### 개별 컨테이너 구성 {#configure-individual-containers}

`docker run`을 사용하여 컨테이너를 시작할 때 컨테이너의 CPU 우선 순위를 제어하기 위해 여러 플래그를 전달할 수 있습니다. 적절한 값에 대한 정보는 운영 체제의 문서 또는 `ulimit` 명령을 참조하십시오.

| 옵션                     | 설명                                                                                                                                                                               |
| :------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `--cap-add=sys_nice`       | 컨테이너에 `CAP_SYS_NICE` 기능을 부여하여 컨테이너가 프로세스 `nice` 값을 높이고, 실시간 스케줄링 정책을 설정하고, CPU 친화성을 설정하고, 기타 작업을 수행할 수 있습니다. |
| `--cpu-rt-runtime=<value>` | Docker 데몬의 실시간 스케줄러 기간 내에서 컨테이너가 실시간 우선 순위로 실행할 수 있는 최대 마이크로초 수입니다. `--cap-add=sys_nice` 플래그도 필요합니다.        |
| `--ulimit rtprio=<value>`  | 컨테이너에 허용되는 최대 실시간 우선 순위입니다. `--cap-add=sys_nice` 플래그도 필요합니다.                                                                                    |

다음 예제 명령은 `debian:jessie` 컨테이너에 이 세 가지 플래그를 설정합니다.

```console
$ docker run -it \
    --cpu-rt-runtime=950000 \
    --ulimit rtprio=99 \
    --cap-add=sys_nice \
    debian:jessie
```

커널 또는 Docker 데몬이 올바르게 구성되지 않은 경우 오류가 발생합니다.

## GPU {#gpu}

### NVIDIA GPU 접근 {#access-an-nvidia-gpu}

#### 사전 요구 사항 {#prerequisites}

공식 [NVIDIA 드라이버 페이지](https://www.nvidia.com/Download/index.aspx)를 방문하여 적절한 드라이버를 다운로드하고 설치하십시오. 설치 후 시스템을 재부팅하십시오.

GPU가 실행 중이고 접근 가능한지 확인하십시오.

#### nvidia-container-toolkit 설치 {#install-nvidia-container-toolkit}

공식 NVIDIA Container Toolkit [설치 지침](https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html)을 따르십시오.

#### GPU 사용 노출 {#expose-gpus-for-use}

컨테이너를 시작할 때 `--gpus` 플래그를 포함하여 GPU 리소스에 접근하십시오. 사용할 GPU 수를 지정하십시오. 예를 들어:

```console
$ docker run -it --rm --gpus all ubuntu nvidia-smi
```

모든 사용 가능한 GPU를 노출하고 다음과 유사한 결과를 반환합니다:

```bash
+-------------------------------------------------------------------------------+
| NVIDIA-SMI 384.130            	Driver Version: 384.130               	|
|-------------------------------+----------------------+------------------------+
| GPU  Name 	   Persistence-M| Bus-Id    	Disp.A | Volatile Uncorr. ECC   |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M.   |
|===============================+======================+========================|
|   0  GRID K520       	Off  | 00000000:00:03.0 Off |                  N/A      |
| N/A   36C	P0    39W / 125W |  	0MiB /  4036MiB |      0%  	Default |
+-------------------------------+----------------------+------------------------+
+-------------------------------------------------------------------------------+
| Processes:                                                       GPU Memory   |
|  GPU   	PID   Type   Process name                         	Usage  	|
|===============================================================================|
|  No running processes found                                                   |
+-------------------------------------------------------------------------------+
```

`device` 옵션을 사용하여 GPU를 지정하십시오. 예를 들어:

```console
$ docker run -it --rm --gpus device=GPU-3a23c669-1f69-c64e-cf85-44e9b07e7a2a ubuntu nvidia-smi
```

특정 GPU를 노출합니다.

```console
$ docker run -it --rm --gpus '"device=0,2"' ubuntu nvidia-smi
```

첫 번째 및 세 번째 GPU를 노출합니다.

:::note
NVIDIA GPU는 단일 엔진을 실행하는 시스템에서만 접근할 수 있습니다.
:::

#### NVIDIA 기능 설정 {#set-nvidia-capabilities}

기능을 수동으로 설정할 수 있습니다. 예를 들어 Ubuntu에서 다음을 실행할 수 있습니다:

```console
$ docker run --gpus 'all,capabilities=utility' --rm ubuntu nvidia-smi
```

이 명령은 `utility` 드라이버 기능을 활성화하여 `nvidia-smi` 도구를 컨테이너에 추가합니다.

기능 및 기타 구성은 환경 변수를 통해 이미지에 설정할 수 있습니다. 유효한 변수에 대한 자세한 내용은 [nvidia-container-toolkit](https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/docker-specialized.html) 문서를 참조하십시오. 이러한 변수는 Dockerfile에 설정할 수 있습니다.

이러한 변수를 자동으로 설정하는 CUDA 이미지를 사용할 수도 있습니다. 공식 [CUDA 이미지](https://catalog.ngc.nvidia.com/orgs/nvidia/containers/cuda) NGC 카탈로그 페이지를 참조하십시오.
